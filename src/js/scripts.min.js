var xInitial,yInitial,xOriginal,yOriginal,element_id,interval,is_discarded,element,new_position,carts_missing,top_discarded_cart_path,is_pressed=!1,z_index=40,date_start=null,stack_discard_is_empty=!0,carts_to_reveal=12,actual_reverse="src/img/dorsos/dorso_azul.jpg",move_event="mousemove",up_event="mouseup",down_event="mousedown",array_deck=["copa1","copa2","copa3","copa4","copa5","copa6","copa7","copa10","copa11","copa12","oro1","oro2","oro3","oro4","oro5","oro6","oro7","oro10","oro11","oro12","espada1","espada2","espada3","espada4","espada5","espada6","espada7","espada10","espada11","espada12","basto1","basto2","basto3","basto4","basto5","basto6","basto7","basto10","basto11","basto12"];function events_settings(){carts_missing=document.getElementsByClassName("carts_missing")[0].innerHTML,$(".button_difficulty").click(function(e){choose_difficulty(difficulty_selected=$(this).attr("data-difficulty")),$(".start_difficulty").removeClass("opened"),$(".background_start").removeClass("opened")}),"ontouchstart"in window&&(move_event="touchmove",up_event="touchend",down_event="touchstart"),document.addEventListener(move_event,mouse_moved),$("#cart_up_tier1, #cart_up_tier2, #cart_up_tier3").bind(up_event,mouse_released).bind(down_event,mouse_pressed),$(".reverse_fixed, .carts_missing").bind("click",function(){new_cart_from_deck(),null==date_start&&(date_start=new Date)}),$(".open_options_instruccions").click(function(){$(".instruccions").addClass("on"),$(".options").addClass("on"),$(".background_options_instruccions").addClass("opened")}),$(".background_options_instruccions, .close_options").click(function(){$(".instruccions").removeClass("on"),$(".options").removeClass("on"),$(".background_options_instruccions").removeClass("opened")}),$(".reverse_collapsed").click(function(){sub_expand_and_collapse("reverse")}),$(".wallpaper_collapsed").click(function(){sub_expand_and_collapse("wallpaper")}),$(".container_checkbox input[name='reverse']").bind("change",swap_reverse),$(".container_checkbox input[name='wallpaper']").bind("change",swap_wallpaper),$(".new_game").click(function(){location.reload()})}function choose_difficulty(e){var t=0;switch(e){case"Facil":carts_missing="28",carts_to_reveal=12,t=4,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing;break;case"Medio":carts_missing="25",carts_to_reveal=15,t=5,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing;break;case"Dificil":carts_missing="22",carts_to_reveal=18,t=6,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing}4<t&&dom_difficulty(t),setTimeout(first_flop,500)}function dom_difficulty(e){$("#cart_up_tier1, #cart_up_tier2, #cart_up_tier3").attr("src",actual_reverse).attr("data-position",e).removeClass("flip").removeAttr("style"),$(".tier .reverse_helper").remove(),$(".deck_cart").remove();for(var t=4;t<e;t++)$("<img>").attr({src:actual_reverse,alt:"Dorso"}).attr("data-position",t).addClass("carts hide").insertAfter($(".tier img[data-position='"+parseInt(t-1)+"']"));for(tier=1;tier<=3;tier++)events_on("cart_up_tier"+tier);create_reverse($("#cart_up_tier1")),create_reverse($("#cart_up_tier2")),create_reverse($("#cart_up_tier3"))}function events_on(e){$("#"+e).bind(up_event,mouse_released).bind(down_event,mouse_pressed)}function events_down(e){$("#"+e).unbind(up_event,mouse_released).unbind(down_event,mouse_pressed)}function mouse_pressed(e){e.preventDefault(),xInitial="ontouchstart"in window?e.targetTouches[0].pageX:e.clientX,yInitial="ontouchstart"in window?e.targetTouches[0].pageY:e.clientY,element_id=this.id;e=get_position(element=document.getElementById(element_id));yOriginal=e[0],xOriginal=e[1],is_pressed=!0}function mouse_moved(e){var t,a,s;is_pressed&&(t="ontouchstart"in window?e.targetTouches[0].pageX:e.clientX,e="ontouchstart"in window?e.targetTouches[0].pageY:e.clientY,a=t-xInitial,s=e-yInitial,xInitial=t,yInitial=e,new_position=get_position(element),element.style.top=new_position[0]+s+"px",element.style.left=new_position[1]+a+"px",outside_field(a,s),is_discarded=is_discard())}function outside_field(e,t){mediaquerytablet=window.matchMedia("(max-width: 768px)"),mediaquerymv=window.matchMedia("(max-width: 425px)"),cart_width=mediaquerytablet.matches?60:100,cart_width=mediaquerymv.matches?40:100,(new_position[1]+e>=viewportToPixels("100vw")-cart_width||new_position[1]+e<=0)&&(element.style.top=yOriginal+"px",element.style.left=xOriginal+"px",is_pressed=!1),cart_height=mediaquerytablet.matches?100:140,cart_height=mediaquerymv.matches?70:140,(new_position[0]+t>=viewportToPixels("100vh")-cart_height||new_position[0]+t<=0)&&(element.style.top=yOriginal+"px",element.style.left=xOriginal+"px",is_pressed=!1)}function is_discard(){var e=viewportToPixels("48vh"),t=viewportToPixels("20vw"),a=window.matchMedia("(max-width: 768px)");return radio=a.matches?50:150,new_position[0]<=e+radio&&new_position[0]>=e-radio&&new_position[1]<=t+radio&&new_position[1]>=t-radio}function mouse_released(){is_pressed=!1,is_discarded&&cart_can_go_to_stack_discard(element.getAttribute("src"))?(element.classList.add("stack_discard"),z_index++,element.style.zIndex=z_index,events_down(element_id),top_discarded_cart_path=element.getAttribute("src"),reveal_next_cart(),null==date_start&&(date_start=new Date)):(element.style.top=yOriginal+"px",element.style.left=xOriginal+"px")}function get_position(e){var t=new Array(4);return t[0]=parseInt(document.defaultView.getComputedStyle(e,null).getPropertyValue("top")),t[1]=parseInt(document.defaultView.getComputedStyle(e,null).getPropertyValue("left")),t}function sub_expand_and_collapse(e){switch(e){case"reverse":$(".reverse_expanded").hasClass("sub_expand_anim")?($(".reverse_expanded").removeClass("sub_expand_anim"),$(".reverse_expanded").addClass("sub_collapse_anim"),$(".reverse_collapsed i").removeClass("fa-angle-up"),$(".reverse_collapsed i").addClass("fa-angle-down")):($(".reverse_expanded").removeClass("sub_collapse_anim"),$(".reverse_expanded").addClass("sub_expand_anim"),$(".reverse_collapsed i").removeClass("fa-angle-down"),$(".reverse_collapsed i").addClass("fa-angle-up"));break;case"wallpaper":$(".wallpaper_expanded").hasClass("sub_expand_anim")?($(".wallpaper_expanded").removeClass("sub_expand_anim"),$(".wallpaper_expanded").addClass("sub_collapse_anim"),$(".wallpaper_collapsed i").removeClass("fa-angle-up"),$(".wallpaper_collapsed i").addClass("fa-angle-down")):($(".wallpaper_expanded").removeClass("sub_collapse_anim"),$(".wallpaper_expanded").addClass("sub_expand_anim"),$(".wallpaper_collapsed i").removeClass("fa-angle-down"),$(".wallpaper_collapsed i").addClass("fa-angle-up"))}}function viewportToPixels(e){var e=e.match(/([0-9\.]+)(vh|vw)/),t=Number(e[1]);return window[["innerHeight","innerWidth"][["vh","vw"].indexOf(e[2])]]*(t/100)}function create_reverse(e){var t=e.attr("data-position"),a=e.attr("id");e.hasClass("deck_cart")?$("<img>").attr({src:actual_reverse,alt:"Dorso Auxiliar"}).attr("data-position",t).addClass("carts deck_reverse").insertAfter(document.getElementsByClassName("deck_cart")[0]):$("<img>").attr({src:actual_reverse,alt:"Dorso Auxiliar"}).attr("data-position",t).addClass("carts reverse_helper").insertAfter($("#"+a))}function first_flop(){$(".reverse_helper").addClass("flip"),$("#cart_up_tier1").addClass("flip").attr("src",path_cart()),$("#cart_up_tier2").addClass("flip").attr("src",path_cart()),$("#cart_up_tier3").addClass("flip").attr("src",path_cart()),new_cart_from_deck()}function path_cart(){return"src/spanish-deck/"+random_cart()+".png"}function random_cart(){var e=Math.floor(Math.random()*array_deck.length);return array_deck.splice(e,1)}function new_cart_from_deck(){var e,t;0<(carts_missing=document.getElementsByClassName("carts_missing")[0].innerHTML)&&(e=path_cart(),t=$("<img>").attr({src:e,alt:"Nueva Carta",style:"z-index: "+z_index}).addClass("carts deck_cart"),z_index++,t.insertAfter(document.getElementsByClassName("carts_missing")[0]),carts_missing--,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing,create_reverse($(".deck_cart")),$(".deck_reverse, .deck_cart").addClass("new_cart"),top_discarded_cart_path=e),0==carts_missing&&($(".reverse_fixed").remove(),$(".carts_missing").addClass("no_carts"),$(".deck").addClass("empty"),lose_game()),setTimeout(function(){$(".reverse_fixed, .carts_missing").bind("click",new_cart_from_deck)},600),$(".reverse_fixed, .carts_missing").unbind("click")}function get_value_of_cart(e){e=e.split(".jpg")[0].match(/[0-9]/g);return void 0===e[1]?parseInt(e):parseInt(e[0].concat(e[1]))}function cart_can_go_to_stack_discard(e){var t,a;return!(!e||(e=get_value_of_cart(e),(7==(t=get_value_of_cart(top_discarded_cart_path))&&10==e||10==t&&7==e||12==t&&1==e||1==t&&12==e)&&(a=!0),t!=e+1&&t!=e-1&&!a))}function reveal_next_cart(){var e,t,a;is_discarded&&(carts_to_reveal--,e=element.getAttribute("data-position"),t=element_id.substring(element_id.length-1,element_id.length),$(".tier"+t+" .reverse_helper").remove(),element.setAttribute("alt","Carta Descartada"),element.removeAttribute("id"),1<e&&(create_reverse($(".tier"+t+" img[data-position='"+parseInt(e-1)+"']")),$(".tier"+t+" .hide[data-position='"+parseInt(e-1)+"']").attr({id:"cart_up_tier"+t,alt:"Carta Boca Arriba"}).removeClass("hide"),a=path_cart(),setTimeout(function(){switch($(".tier"+t+".reverse_helper").addClass("flip"),t){case"1":$("#cart_up_tier1").addClass("flip").attr("src",a),events_on("cart_up_tier1");break;case"2":$("#cart_up_tier2").addClass("flip").attr("src",a),events_on("cart_up_tier2");break;case"3":$("#cart_up_tier3").addClass("flip").attr("src",a),events_on("cart_up_tier3")}},300)),0==carts_to_reveal&&win_game(),setTimeout(function(){0==carts_missing&&lose_game()},1e3))}function win_game(){document.getElementsByClassName("result")[0].innerHTML="¡Felicidades!",document.getElementsByClassName("container_results")[0].classList.add("end_game"),document.getElementsByClassName("background_results")[0].classList.add("end_game"),document.getElementsByClassName("icon_result")[0].setAttribute("src","src/img/victory.png"),$(".reverse_fixed, .carts_missing").unbind("click"),get_timer("win")}function lose_game(){var e=!!document.getElementById("cart_up_tier1")&&document.getElementById("cart_up_tier1").getAttribute("src"),t=!!document.getElementById("cart_up_tier2")&&document.getElementById("cart_up_tier2").getAttribute("src"),a=!!document.getElementById("cart_up_tier3")&&document.getElementById("cart_up_tier3").getAttribute("src"),e=cart_can_go_to_stack_discard(e),t=cart_can_go_to_stack_discard(t),a=cart_can_go_to_stack_discard(a);e||t||a||(document.getElementsByClassName("result")[0].innerHTML="¡Suerte la próxima vez!",document.getElementsByClassName("container_results")[0].classList.add("end_game"),document.getElementsByClassName("background_results")[0].classList.add("end_game"),document.getElementsByClassName("icon_result")[0].setAttribute("src","src/img/defeat.png"),get_timer("lose"))}function get_timer(e){var t="",a=(new Date).getTime()-date_start.getTime(),s=Math.floor(a/6e4),a=(a-=6e4*s,Math.floor(a/1e3)),t=0==s?a+" seg. ":0==a?s+" min. ":s+" min. y "+a+" seg. ";document.getElementsByClassName("time_result")[0].innerHTML=t,"win"==e&&(document.getElementsByClassName("programmer_greeting")[0].innerHTML="¿Quieres superarlo?"),"lose"==e&&(document.getElementsByClassName("programmer_greeting")[0].innerHTML="¿Quieres volver a intentarlo?")}function swap_reverse(){for(var e=document.getElementsByName("reverse"),t=0;t<e.length&&!e[t].checked;t++);var a=document.getElementsByClassName("carts");switch(e[t].getAttribute("data-reverse")){case"Azul":for(num_cart=0;num_cart<a.length;num_cart++)a[num_cart].getAttribute("src").includes("dorsos")&&a[num_cart].setAttribute("src","src/img/dorsos/dorso_azul.jpg");actual_reverse="src/img/dorsos/dorso_azul.jpg";break;case"Oscuro":for(num_cart=0;num_cart<a.length;num_cart++)a[num_cart].getAttribute("src").includes("dorsos")&&a[num_cart].setAttribute("src","src/img/dorsos/dorso_oscuro.jpg");actual_reverse="src/img/dorsos/dorso_oscuro.jpg";break;case"Hearthstone":for(num_cart=0;num_cart<a.length;num_cart++)a[num_cart].getAttribute("src").includes("dorsos")&&a[num_cart].setAttribute("src","src/img/dorsos/dorso_hs.png");actual_reverse="src/img/dorsos/dorso_hs.png"}}function swap_wallpaper(){for(var e=document.getElementsByName("wallpaper"),t=0;t<e.length&&!e[t].checked;t++);var a=document.getElementsByTagName("body")[0],s=e[t].getAttribute("data-wallpaper");a.removeAttribute("class"),a.classList.add(s.toLowerCase())}$(document).ready(function(){events_settings(),document.getElementsByName("reverse")[0].checked="checked",document.getElementsByName("wallpaper")[0].checked="checked"});